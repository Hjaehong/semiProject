<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>recordDetail</title>
    <link th:href="@{/css/recordDetail.css}" rel="stylesheet" type="text/css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
        const successMessage = "[[${ successMessage}]]";
        if (successMessage){
            alert(successMessage);
        }
    </script>
</head>
<body>
<div th:replace="common/header.html"></div>
    <div class="posting">
        <div class="head">
            <div class="mascot">
                <div class="mascot-img">
                    <img th:src="@{${RecordOne.cityDTO.badgeImg}}" alt="마스코트이미지"/>
                </div>
                <h6 th:text="${RecordOne.cityDTO.locationDTO.locName}" class="localName"></h6>
                <h6 th:text="${RecordOne.cityDTO.cityName}"></h6>
            </div>

            <h2 class="title" th:text="${RecordOne.rcTitle}"></h2>

            <div class="writer">
                <span> 작성자 : </span>
                <span th:text="${RecordOne.userDTO.nickname}"></span>
            </div>

            <div class="travelDate">
                <span> 여행일자 : </span>
                <span class="date" th:text="${RecordOne.travelStartDate}"></span>
                <span> ~ </span>
                <span class="date" th:text="${RecordOne.travelEndDate}" ></span>
            </div>
        </div>

        <img  th:src="@{${RecordOne.fileDTO.imgPath}}" alt="여행지사진" class="travelImg" th:name="imgFile"/>

        <div class="content">
            <pre th:text="${RecordOne.rcDetail}"></pre>
            <div class="tag" th:text="${RecordOne.tagDTO.tagName}"/>
        </div>

        <div class="edit-delete">
            <th:block th:if ="${samePerson == 0}">
                <form class="edit" action="/record/editRecord" method="post" enctype="multipart/form-data">
                    <input type="hidden" th:name="recordNo" th:value="${RecordOne.recordNo}"/>
                    <button type="submit"> 수정 </button>
                </form>
                <form class="delete" action="/record/deleteRecord" method="post">
                    <input type="hidden" th:name="recordNo" th:value="${RecordOne.recordNo}"/>
                    <button type="submit"> 삭제 </button>
                </form>
            </th:block>
        </div>

        <div class="heart">
            <th:block th:if ="${heartCheck == 0}">
                <img th:id="btn_heart" th:src="@{/image/heart_before.png}" alt="빈하트이미지" onclick="changeHeart()"/>
                <span>게시글 저장하기</span>
            </th:block>
            <th:block th:if ="${heartCheck == 1}">
                <img th:id="btn_heart" th:src="@{/image/heart_after.png}" alt="꽉찬하트이미지" onclick="changeHeart()"/>
                <span>게시글 저장하기</span>
            </th:block>
            <th:block th:if ="${heartCheck == 2}">
<!--                <img th:id="btn_heart" th:src="@{/image/heart_before.png}" alt="빈하트이미지" onclick="changeHeart()"/>-->
            </th:block>
            <th:block th:if="${heartCheck == 3}">
                <img th:id="btn_heart" th:src="@{/image/heart_before.png}" alt="빈하트이미지" onclick="changeHeart()"/>
                <span>게시글 저장하기</span>
            </th:block>
        </div>

        <div>댓글 : <span id="comCount">0</span></div>
        <!-- 댓글리스트 -->
        <div>
            <div>
                <form>
                    <div id="commentListView">

                        <!-- 작성자와 같을 경우 수정 삭제 -->
                        <button type="submit" name="submit" value="update">수정</button>
                        <button type="submit" name="submit" value="delete">삭제</button>
                    </div>
                </form>
            </div>
        </div>
        <div class="comment-form"  id="commentArea">
            <!--            사이즈 조정하기~-->
            <div class="profile">
                <div class="profile-img">
<!--                    <img src="/image/profile.png" alt="프로필이미지"/>-->
                </div>
                <span class="comment-writer"> 작성자 </span>
            </div>
            <textarea id="commentContain"></textarea>
            <button>등록</button>
        </div>

        <a class="back-list" th:href="@{/record/recordList}"> <- 목록으로 </a>
    </div>
</body>
    <script th:inline="javascript">
        /*<![CDATA[*/

        let recordNo = [[${RecordOne.recordNo}]];
        let userNo = [[${userNo}]];
        let heartCheck = [[${heartCheck}]];
        console.log(heartCheck);

        let loginMember = [[${loginMember}]];
        console.log(loginMember);

        function changeHeart(){
            if(heartCheck == 0 || heartCheck == 1){
                $.ajax({
                    type:"POST",
                    url:"/record/clickHeart",
                    data: { 'recordNo' : recordNo,
                        'userNo' : userNo},
                    dataType: "json",
                    success: function(result){
                        if (result == 1) {
                            $("#btn_heart").attr("src", "/image/heart_before.png");
                        }
                        else {
                            $("#btn_heart").attr("src", "/image/heart_after.png");
                        }
                    }
                });
            }
            else {
                alert("로그인 후 이용해주세요!");
            }
        }
        /*]]>*/

    </script>
<script th:inline="javascript" th:src="@{/js/recordDetail.js}"> </script>
</html>